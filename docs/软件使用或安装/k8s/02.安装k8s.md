---
article: false
title: 02.安装k8s
---


## k8s docker 对应版本
```text
Kubernetes 版本	    Docker 版本
1.20        	        19.03, 19.03.12
1.21	                20.10, 20.10.7
1.22	                20.10, 20.10.7
1.23	                20.10, 20.10.7
```
k8s 1.24 以上不默认支持 docker 需要安装容器运行时


## 配置
```text
192.168.0.50        node50        master
192.168.0.51        node51        master
192.168.0.52        node52        master
192.168.0.53        node53        node
192.168.0.54        node54        node
192.168.0.55        node55        node

k8s     1.23    
docker  最新

```

## 安装过程
### 第一步: 所有机器安装Docker
安装方法: [Docker包安装](../docker/docker01-包安装)

### 第二步: 设置主机名与时区
```shell
timedatectl set-timezone Asia/Shanghai #  都要执行
hostnamectl set-hostname node50       #  0.50
hostnamectl set-hostname node51       #  0.51
hostnamectl set-hostname node52       #  0.52
hostnamectl set-hostname node53       #  0.53
hostnamectl set-hostname node54       #  0.54
hostnamectl set-hostname node55       #  0.55
```
### 第三步: 添加hosts网络主机配置,方便寻找主机
vi /etc/hosts
```shell
192.168.0.50  node50
192.168.0.51  node51
192.168.0.52  node52
192.168.0.53  node53
192.168.0.54  node54
192.168.0.55  node55
```
### 第四步: 关闭防火墙，这一步操作是为了防止在学习阶段由于防火墙造成的各种网络问题，生产环境跳过这一步，
```shell
systemctl stop firewalld
systemctl disable firewalld
```
### 第五步: 关闭selinux
```shell
sed -i 's/enforcing/disabled/' /etc/selinux/config  # 永久
setenforce 0  # 临时
```
### 第六步: 关闭交换区
```shell
swapoff -a
vi /etc/fstab
#swap一行注释
#/dev/mapper/centos-swap swap swap defaults 0 0
```
### 第七步: 允许 iptables 检查桥接流量
```shell
cat <<EOF | sudo tee /etc/modules-load.d/k8s.conf
br_netfilter
EOF

cat <<EOF | sudo tee /etc/sysctl.d/k8s.conf
net.bridge.bridge-nf-call-ip6tables = 1
net.bridge.bridge-nf-call-iptables = 1
EOF
sudo sysctl --system
```
### 第八步: ipset ipvsadm  ipvsadm配置
```shell
#########
yum install -y ipset ipvsadm
#########
cat > /etc/sysconfig/modules/ipvs.modules <<EOF
#!/bin/bash
modprobe -- ip_vs
modprobe -- ip_vs_rr
modprobe -- ip_vs_wrr
modprobe -- ip_vs_sh
modprobe -- nf_conntrack
EOF
########
chmod 755 /etc/sysconfig/modules/ipvs.modules
bash /etc/sysconfig/modules/ipvs.modules 
lsmod | grep -e ip_vs -e nf_conntrack

```


### 安装容器运行时   k8s < 1.24 忽略
```text
https://github.com/Mirantis/cri-dockerd
下载: 0.3.2 rpm
开机自启
systemctl enable cri-docker

vi /usr/lib/systemd/system/cri-docker.service  # 修改如下
ExecStart=/usr/bin/cri-dockerd --network-plugin=cni --pod-infra-container-image=registry.aliyuncs.com/google_containers/pause:3.9 --container-runtime-endpoint fd://

systemctl start cri-docker && systemctl enable cri-docker

```

### 第十步: 修改 kubernetes源：
```shell
cat > /etc/yum.repos.d/kubernetes.repo << EOF
[kubernetes]
name=Kubernetes
baseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64
enabled=1
gpgcheck=0
repo_gpgcheck=0
gpgkey=https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg https://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg
EOF
```


### 第十一步: 装kubeadm 和 kubelet
```shell
yum install -y kubelet-1.23.16-0 kubeadm-1.23.16-0 kubectl-1.23.16-0
sudo systemctl enable --now kubelet
```

### 拉取docker 镜像
```shell

```

### 初始化Master节点
```shell

```

### 工作节点加入集群
```shell

```

### 查看节点
```shell
kubectl get nodes
```
### 部署容器网络 （master执行） calico  官网
```shell

```





