---
article: false
title: 40.å¤šè¿›ç¨‹-ç®¡é“
---

## è¿›ç¨‹é—´é€šä¿¡
```text
1.ç®¡é“ï¼ˆpipeï¼‰ï¼šå•å‘é€šä¿¡ï¼Œé€‚ç”¨äºçˆ¶å­è¿›ç¨‹ã€‚
2.æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆmessage queueï¼‰ï¼šå¤šè¿›ç¨‹å¯è¯»å†™ï¼Œç±»ä¼¼æ¶ˆæ¯é˜Ÿåˆ—ã€‚
3.å…±äº«å†…å­˜ï¼ˆshared memoryï¼‰ï¼šæœ€å¿«çš„æ–¹å¼ï¼Œå¤šä¸ªè¿›ç¨‹å…±äº«ä¸€å—å†…å­˜ã€‚
4.ä¿¡å·é‡ï¼ˆsemaphoreï¼‰ï¼šç”¨äºåŒæ­¥å¤šä¸ªè¿›ç¨‹ï¼Œé¿å…èµ„æºç«äº‰ã€‚
5.å¥—æ¥å­—ï¼ˆsocketï¼‰ï¼šé€‚ç”¨äºä¸åŒä¸»æœºé—´çš„è¿›ç¨‹é€šä¿¡ã€‚
```

### ç®¡é“é€šä¿¡
çˆ¶è¿›ç¨‹å†™ï¼Œå­è¿›ç¨‹è¯»
```cpp
#include <stdio.h>
#include <unistd.h>
#include <string.h>

int main()
{
    int fd[2];
    pipe(fd);
    pid_t pid = fork();

    if (pid > 0)
    {
        // çˆ¶è¿›ç¨‹
        close(fd[0]); // å…³é—­è¯»ç«¯
        char msg[] = "Hello from parent!";
        write(fd[1], msg, strlen(msg) + 1);
        close(fd[1]); // å…³é—­å†™ç«¯
    }
    else if (pid == 0)
    {
        // å­è¿›ç¨‹
        close(fd[1]); // å…³é—­å†™ç«¯
        char buffer[100];
        read(fd[0], buffer, sizeof(buffer));
        printf("å­è¿›ç¨‹æ”¶åˆ°æ¶ˆæ¯: %s\n", buffer);
        close(fd[0]); // å…³é—­è¯»ç«¯
    }
    return 0;
}

```

å­è¿›ç¨‹å†™ï¼Œçˆ¶è¿›ç¨‹è¯»
```cpp
#include <stdio.h>
#include <unistd.h>
#include <string.h>

int main() {
    int fd[2];
    pipe(fd);
    pid_t pid = fork();

    if (pid > 0) {  // çˆ¶è¿›ç¨‹
        close(fd[1]);  // å…³é—­å†™ç«¯
        char buffer[100];
        read(fd[0], buffer, sizeof(buffer));
        printf("çˆ¶è¿›ç¨‹æ”¶åˆ°: %s\n", buffer);
        close(fd[0]);  // å…³é—­è¯»ç«¯
    } else if (pid == 0) {  // å­è¿›ç¨‹
        close(fd[0]);  // å…³é—­è¯»ç«¯
        char msg[] = "Hello from child!";
        write(fd[1], msg, strlen(msg) + 1);
        close(fd[1]);  // å…³é—­å†™ç«¯
    }
    return 0;
}

```
### ç®¡é“é€šä¿¡çš„å¸¸è§é—®é¢˜
```text
(1) æ­»é”
    å¦‚æœè¯»ç«¯æœªå…³é—­ï¼Œå†™ç«¯ç­‰å¾…ï¼Œå¯èƒ½ä¼šå¡ä½ã€‚
    è§£å†³æ–¹æ¡ˆï¼š
        å…³é—­æœªä½¿ç”¨çš„ç«¯å£
        éé˜»å¡è¯»å†™
(2) è¿›ç¨‹é¡ºåºé—®é¢˜
    fork() ä¹‹åï¼Œçˆ¶å­è¿›ç¨‹å¯èƒ½å¹¶è¡Œæ‰§è¡Œï¼Œéœ€è¦åŒæ­¥ã€‚
    å¯ä»¥ç”¨ sleep() æˆ– wait() è®©çˆ¶è¿›ç¨‹ç­‰å¾…å­è¿›ç¨‹æ‰§è¡Œå®Œã€‚
```



### è¿›ç¨‹é€šä¿¡ æ¶ˆæ¯é˜Ÿåˆ—
å‘é€æ¶ˆæ¯è¿›ç¨‹
```cpp
#include <stdio.h>
#include <stdlib.h>
#include <sys/ipc.h>
#include <sys/msg.h>
#include <string.h>

#define MSG_KEY 1234

struct msgbuf {
    long mtype;
    char mtext[128];
};

int main() {
    int msgid = msgget(MSG_KEY, IPC_CREAT | 0666); // åˆ›å»ºæ¶ˆæ¯é˜Ÿåˆ—
    if (msgid == -1) {
        perror("msgget");
        exit(1);
    }

    struct msgbuf msg;
    msg.mtype = 1;  // æ¶ˆæ¯ç±»å‹
    strcpy(msg.mtext, "Hello from sender!");

    // å‘é€æ¶ˆæ¯
    if (msgsnd(msgid, &msg, sizeof(msg.mtext), 0) == -1) {
        perror("msgsnd");
        exit(1);
    }

    printf("æ¶ˆæ¯å‘é€æˆåŠŸ: %s\n", msg.mtext);
    return 0;
}

```

æ¥æ”¶æ¶ˆæ¯è¿›ç¨‹
```cpp
#include <stdio.h>
#include <stdlib.h>
#include <sys/ipc.h>
#include <sys/msg.h>

#define MSG_KEY 1234

struct msgbuf {
    long mtype;
    char mtext[128];
};

int main() {
    int msgid = msgget(MSG_KEY, 0666); // è·å–æ¶ˆæ¯é˜Ÿåˆ—
    if (msgid == -1) {
        perror("msgget");
        exit(1);
    }

    struct msgbuf msg;

    // æ¥æ”¶æ¶ˆæ¯
    if (msgrcv(msgid, &msg, sizeof(msg.mtext), 1, 0) == -1) {
        perror("msgrcv");
        exit(1);
    }

    printf("æ”¶åˆ°æ¶ˆæ¯: %s\n", msg.mtext);
    return 0;
}

```

æ¶ˆæ¯é˜Ÿåˆ—åˆ›å»ºåä¸ä¼šè‡ªåŠ¨é”€æ¯ï¼Œéœ€è¦æ‰‹åŠ¨åˆ é™¤
```cpp
#include <stdio.h>
#include <stdlib.h>
#include <sys/ipc.h>
#include <sys/msg.h>

#define MSG_KEY 1234

int main() {
    int msgid = msgget(MSG_KEY, 0666);
    if (msgid == -1) {
        perror("msgget");
        exit(1);
    }

    // åˆ é™¤æ¶ˆæ¯é˜Ÿåˆ—
    if (msgctl(msgid, IPC_RMID, NULL) == -1) {
        perror("msgctl");
        exit(1);
    }

    printf("æ¶ˆæ¯é˜Ÿåˆ—å·²åˆ é™¤\n");
    return 0;
}

```

### å…±äº«å†…å­˜
```cpp
#include <stdio.h>
#include <stdlib.h>
#include <sys/ipc.h>
#include <sys/shm.h>
#include <string.h>
#include <unistd.h>

#define SHM_KEY 1234

int main() {
    int shmid = shmget(SHM_KEY, 1024, IPC_CREAT | 0666);
    char *shmptr = (char *)shmat(shmid, NULL, 0);

    if (fork() == 0) {  // å­è¿›ç¨‹
        sleep(1);  // ç­‰å¾…çˆ¶è¿›ç¨‹å†™å…¥
        printf("å­è¿›ç¨‹è¯»å–: %s\n", shmptr);
        shmdt(shmptr);
    } else {  // çˆ¶è¿›ç¨‹
        strcpy(shmptr, "Hello from parent!");
        wait(NULL);  // ç­‰å¾…å­è¿›ç¨‹ç»“æŸ
        shmdt(shmptr);
        shmctl(shmid, IPC_RMID, NULL);  // åˆ é™¤å…±äº«å†…å­˜
    }
    return 0;
}

```


### ä¿¡å·é‡
ğŸ“Œ sem_p() é˜»å¡è¿›ç¨‹ï¼Œç­‰å¾…ä¿¡å·é‡ã€‚

ğŸ“Œ sem_v() é‡Šæ”¾ä¿¡å·é‡ï¼Œè®©å­è¿›ç¨‹ç»§ç»­æ‰§è¡Œã€‚
```cpp
#include <stdio.h>
#include <stdlib.h>
#include <sys/sem.h>
#include <sys/ipc.h>
#include <sys/types.h>
#include <unistd.h>

#define SEM_KEY 1234  // ä¿¡å·é‡ key

void sem_p(int semid) {  // P æ“ä½œï¼ˆç­‰å¾…ï¼‰
    struct sembuf sem;
    sem.sem_num = 0;
    sem.sem_op = -1;
    sem.sem_flg = 0;
    semop(semid, &sem, 1);
}

void sem_v(int semid) {  // V æ“ä½œï¼ˆä¿¡å·é‡+1ï¼‰
    struct sembuf sem;
    sem.sem_num = 0;
    sem.sem_op = 1;
    sem.sem_flg = 0;
    semop(semid, &sem, 1);
}

int main() {
    int semid = semget(SEM_KEY, 1, IPC_CREAT | 0666);
    semctl(semid, 0, SETVAL, 0);  // åˆå§‹å€¼ 0ï¼Œå­è¿›ç¨‹ç­‰å¾…çˆ¶è¿›ç¨‹

    if (fork() == 0) {  // å­è¿›ç¨‹
        printf("å­è¿›ç¨‹ç­‰å¾…æ•°æ®...\n");
        sem_p(semid);  // ç­‰å¾…çˆ¶è¿›ç¨‹çš„ä¿¡å·
        printf("å­è¿›ç¨‹æ”¶åˆ°ä¿¡å·ï¼Œå¼€å§‹è¯»å–æ•°æ®!\n");
        exit(0);
    } else {  // çˆ¶è¿›ç¨‹
        sleep(2);
        printf("çˆ¶è¿›ç¨‹å†™å…¥æ•°æ®å®Œæˆ!\n");
        sem_v(semid);  // é‡Šæ”¾ä¿¡å·ï¼Œå­è¿›ç¨‹å¯ä»¥ç»§ç»­æ‰§è¡Œ
        wait(NULL);
        semctl(semid, 0, IPC_RMID);  // åˆ é™¤ä¿¡å·é‡
    }
    return 0;
}

```








